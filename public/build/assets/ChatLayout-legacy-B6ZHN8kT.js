System.register(["./app-legacy-DgSxef3f.js","./helpers-legacy-DziSQG3y.js","./UserGroupIcon-legacy-DRSkIOQp.js","./chatStore-legacy-EqN4MWSq.js","./TextInput-legacy-D7p7RPvJ.js","./api-legacy-CEJwtiwR.js","./useBaseQuery-legacy-CVIyBB9y.js","./useTranslation-legacy-CLNYKYSV.js"],function(e,t){"use strict";var r,a,s,n,l,i,o,c,d,g,u,x,h,m,f,v,p,b,y,j;return{setters:[e=>{r=e.i,a=e.h,s=e.f,n=e.r,l=e.j,i=e.d,o=e.L,c=e.k,d=e.c,g=e.H},e=>{u=e.k},e=>{x=e.F,h=e.a},e=>{m=e.U,f=e.u},e=>{v=e.T},e=>{p=e.a},e=>{b=e.Q,y=e.u},e=>{j=e.u}],execute:function(){var t=class extends b{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:r()})}getOptimisticResult(e){return e.behavior=r(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){const{state:r}=e,n=super.createResult(e,t),{isFetching:l,isRefetching:i,isError:o,isRefetchError:c}=n,d=r.fetchMeta?.fetchMore?.direction,g=o&&"forward"===d,u=l&&"forward"===d,x=o&&"backward"===d,h=l&&"backward"===d;return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:s(t,r.data),hasPreviousPage:a(t,r.data),isFetchNextPageError:g,isFetchingNextPage:u,isFetchPreviousPageError:x,isFetchingPreviousPage:h,isRefetchError:c&&!g&&!x,isRefetching:i&&!u&&!h}}};function N({title:e,titleId:t,...r},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{d:"M4.913 2.658c2.075-.27 4.19-.408 6.337-.408 2.147 0 4.262.139 6.337.408 1.922.25 3.291 1.861 3.405 3.727a4.403 4.403 0 0 0-1.032-.211 50.89 50.89 0 0 0-8.42 0c-2.358.196-4.04 2.19-4.04 4.434v4.286a4.47 4.47 0 0 0 2.433 3.984L7.28 21.53A.75.75 0 0 1 6 21v-4.03a48.527 48.527 0 0 1-1.087-.128C2.905 16.58 1.5 14.833 1.5 12.862V6.638c0-1.97 1.405-3.718 3.413-3.979Z"}),n.createElement("path",{d:"M15.75 7.5c-1.376 0-2.739.057-4.086.169C10.124 7.797 9 9.103 9 10.609v4.285c0 1.507 1.128 2.814 2.67 2.94 1.243.102 2.5.157 3.768.165l2.782 2.781a.75.75 0 0 0 1.28-.53v-2.39l.33-.026c1.542-.125 2.67-1.433 2.67-2.94v-4.286c0-1.505-1.125-2.811-2.664-2.94A49.392 49.392 0 0 0 15.75 7.5Z"}))}const w=e("a",n.forwardRef(N));function P({title:e,titleId:t,...r},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{fillRule:"evenodd",d:"M18.97 3.659a2.25 2.25 0 0 0-3.182 0l-10.94 10.94a3.75 3.75 0 1 0 5.304 5.303l7.693-7.693a.75.75 0 0 1 1.06 1.06l-7.693 7.693a5.25 5.25 0 1 1-7.424-7.424l10.939-10.94a3.75 3.75 0 1 1 5.303 5.304L9.097 18.835l-.008.008-.007.007-.002.002-.003.002A2.25 2.25 0 0 1 5.91 15.66l7.81-7.81a.75.75 0 0 1 1.061 1.06l-7.81 7.81a.75.75 0 0 0 1.054 1.068L18.97 6.84a2.25 2.25 0 0 0 0-3.182Z",clipRule:"evenodd"}))}const k=e("F",n.forwardRef(P)),_=e("G",({avatar:e=null})=>l.jsxs(l.Fragment,{children:[e&&l.jsx("div",{className:"chat-image avatar",children:l.jsx("div",{className:"rounded-full w-8",children:l.jsx("img",{src:e})})}),!e&&l.jsx("div",{className:"avatar avatar-placeholder",children:l.jsx("div",{className:"\n                bg-gray-400 text-gray-800 rounded-full w-8\n                dark:bg-gray-700 dark:text-gray-100\n            ",children:l.jsx("span",{className:"text-xl",children:l.jsx(x,{className:"w-4"})})})})]})),O=({conversation:e,selectedConversation:t=null,online:r=null})=>{const a=i().props.auth.user;let s=" border-transparent";return t&&t.id===e.id&&t.is_group===e.is_group&&(s="border-blue-500 bg-blue-50 dark:bg-gray-700/50 shadow-sm"),l.jsxs(o,{href:e.is_group?route("chat.group",e):route("chat.user",e),preserveState:!0,className:"conversation-item flex items-center justify-between gap-3 rounded-md p-3 transition-all cursor-pointer border  text-gray-800 hover:hover:bg-blue-50 dark:text-gray-200 dark:hover:bg-gray-700 "+s+(e.is_group||"admin"!==a.role?" pr-4":" pr-2"),children:[!e.is_group&&l.jsx(m,{user:e,online:r}),e.is_group&&l.jsx(_,{avatar:e.avatar}),l.jsxs("div",{className:"flex-1 text-xs max-w-full overflow-hidden",children:[l.jsx("div",{className:"flex gap-1 justify-between items-center",children:l.jsx("h3",{className:"text-sm font-semibold truncate",children:e.name})}),e.last_message_date&&(e.last_message?l.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 text-nowrap truncate",children:e.last_message}):l.jsxs("p",{className:"text-xs text-gray-600 flex items-center justify-start gap-1 dark:text-gray-400 text-nowrap truncate",children:[l.jsx(k,{className:"w-3"})," Sent an attachment"]}))]}),l.jsxs("div",{className:"flex text-xs flex-col items-center justify-center gap-1",children:[e.last_message_date&&l.jsx("span",{className:"text-nowrap  text-gray-500 dark:text-gray-400",children:u(e.last_message_date)}),e.unread_count>0&&l.jsx("span",{className:"py-1 px-2 rounded-full bg-blue-500 dark:text-black text-white",children:e.unread_count>99?"99+":e.unread_count})]})]})},C=(e={})=>y({queryKey:["conversations",e],queryFn:({pageParam:t=1})=>(async({page:e=1,search:t=""})=>{const{data:r}=await p.get("/conversations",{params:{page:e,search:t}});return r?.data||null})({page:t,...e}),getNextPageParam:e=>{const t=e.meta.current_page;return t<e.meta.last_page?t+1:void 0}},t),U=e("u",c((e,t)=>({onlineUsers:{},setOnlineUsers:t=>e({onlineUsers:t}),addOnlineUser:t=>e(e=>({onlineUsers:{...e.onlineUsers,[t.id]:t}})),removeOnlineUser:t=>e(e=>{const r={...e.onlineUsers};return delete r[t],{onlineUsers:r}}),isUserOnline:e=>!!t().onlineUsers[e]}))),E=e("C",({children:e})=>{const{t:t,isUserOnline:r,selectedConversation:a,conversations:s,onSearch:c,auth:u,isLoading:x,loadMoreRef:m,isFetchingNextPage:p,hasNextPage:b}=function(){const{t:e}=j("sidebar"),t=i(),{data:r,fetchNextPage:a,hasNextPage:s,isFetchingNextPage:l,status:o,isLoading:c}=C(),g=n.useMemo(()=>r?.pages.flatMap(e=>e.data)||[],[r]),u=f(e=>e.setConversations),x=f(e=>e.updateConversation),h=f(e=>e.searchConversations),m=f(e=>e.updateConversationOnDelete),v=f(e=>e.conversations),p=t.props.auth,{setOnlineUsers:b,addOnlineUser:y,removeOnlineUser:N,isUserOnline:w}=U(),P=t.props.selectedConversation,{on:k}=d(),_=n.useRef(0);n.useEffect(()=>{c||0!==g.length&&g.length!==_.current&&(_.current=g.length,u(g))},[g,c]);const O=n.useRef(null);n.useEffect(()=>{if(!s||l)return;const e=new IntersectionObserver(e=>{e[0].isIntersecting&&a()},{threshold:1}),t=O.current;return t&&e.observe(t),()=>t&&e.unobserve(t)},[s,l,a]);const E=e=>{x(e,p.user.id)},R=({prevMessage:e})=>{m(e)};return n.useEffect(()=>{const e=k("message.created",E),t=k("message.deleted",R);return()=>{e(),t()}},[k]),n.useEffect(()=>(Echo.join("online").here(e=>{const t=Object.fromEntries(e.map(e=>[e.id,e]));b(t)}).joining(e=>{y(e)}).leaving(e=>{N(e.id)}).error(e=>{}),()=>{Echo.leave("online")}),[]),{t:e,isUserOnline:w,selectedConversation:P,conversations:v,onSearch:e=>{h(e.target.value.toLowerCase())},auth:p,isLoading:c,loadMoreRef:O,isFetchingNextPage:l,hasNextPage:s}}();return l.jsxs(l.Fragment,{children:[l.jsx(g,{title:"All Chats"}),l.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[l.jsxs("div",{className:"transition-all \n                                    w-full sm:w-[300px] \n                                    bg-gradient-to-b from-blue-50 to-white \n                                    dark:from-slate-800 dark:to-slate-900 \n                                    flex min-h-0 flex-col overflow-hidden \n                                    border-r border-gray-200 dark:border-slate-700 shadow-sm\n                                    "+(a?"-ml-[100%] md:ml-0 lg:ml-0":"ml-0"),children:[l.jsxs("div",{className:"flex items-center justify-between py-3 px-4 text-lg font-semibold \n                                    text-gray-700 dark:text-gray-100 border-b border-gray-200 dark:border-slate-700",children:[t("title"),"admin"===u.user.role&&l.jsx("div",{className:"tooltip tooltip-left","data-tip":t("tooltip.createGroup"),children:l.jsx(o,{href:route("group.create"),className:"text-blue-500 hover:text-blue-700 dark:text-indigo-400 dark:hover:text-indigo-300",children:l.jsx(h,{className:"w-7 h-7 inline-block ml-2"})})})]}),l.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-slate-700",children:l.jsx(v,{onKeyUp:c,placeholder:t("searchPlaceholder"),className:"w-full bg-white/70 dark:bg-slate-700 \n                                text-gray-800 dark:text-gray-100 \n                                placeholder-gray-400 dark:placeholder-gray-300 \n                                border border-gray-300 dark:border-slate-600 \n                                focus:ring focus:ring-blue-400 focus:border-blue-400 rounded-lg "})}),x?[1,2,3,4].map(e=>l.jsx(M,{},e)):l.jsx(R,{sortedConversations:s,t:t,selectedConversation:a,isUserOnline:r,loadMoreRef:m,hasNextPage:b,isFetchingNextPage:p})]}),l.jsx("div",{className:"w-full flex-1 mx-auto flex flex-col overflow-x-hidden overflow-y-auto bg-gray-50 dark:bg-slate-900 text-gray-800 dark:text-gray-100",children:e})]})]})}),R=({sortedConversations:e,t:t,selectedConversation:r,isUserOnline:a,loadMoreRef:s,isFetchingNextPage:n,hasNextPage:i})=>l.jsxs("div",{className:"hide-scrollbar flex-1 overflow-y-auto px-2 pt-1 pb-5 space-y-1",children:[e&&e.map(e=>l.jsx(O,{conversation:e,selectedConversation:r,online:a(e.receiver_id)},`${e.is_group?"group_":"chat_"}${e.id}`)),i&&l.jsx("div",{ref:s,className:"h-6"}),n&&l.jsx("div",{className:"text-center text-sm text-gray-500 py-2",children:"Loading more..."}),0===e?.length&&l.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-6",children:[l.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4",children:l.jsx(w,{className:"h-12 w-12 text-gray-400"})}),l.jsx("h2",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:t("noConversations.title")}),l.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2 max-w-sm",children:t("noConversations.message")})]})]}),M=()=>l.jsxs("div",{className:"conversation-item flex items-center justify-between gap-3 rounded-md p-3 border border-transparent text-gray-800 dark:text-gray-200 animate-pulse",children:[l.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-full"}),l.jsxs("div",{className:"flex-1 text-xs max-w-full overflow-hidden",children:[l.jsxs("div",{className:"flex gap-1 justify-between items-center",children:[l.jsx("div",{className:"h-3 w-2/3 bg-gray-200 dark:bg-gray-700 rounded"}),l.jsx("div",{className:"h-3 w-10 bg-gray-200 dark:bg-gray-700 rounded"})]}),l.jsx("div",{className:"mt-2 h-3 w-5/6 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),F=Object.freeze(Object.defineProperty({__proto__:null,default:E},Symbol.toStringTag,{value:"Module"}));e("b",F)}}});
