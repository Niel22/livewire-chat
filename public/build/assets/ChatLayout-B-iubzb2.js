import{i as P,h as L,f as S,r as l,j as t,d as _,L as C,k as A,c as D,H as I}from"./app-BIvaOuEf.js";import{k as $}from"./helpers-B1ZXKWgC.js";import{F as B,a as Q}from"./UserGroupIcon-CWwaL256.js";import{U as T,u as p}from"./chatStore-CKiPf-2p.js";import{T as G}from"./TextInput-CMamx1LG.js";import{a as Z}from"./api-VUh7n_q7.js";import{Q as q,u as H}from"./useBaseQuery-DcobsDej.js";import{u as K}from"./useTranslation-CQt-ezys.js";var z=class extends q{constructor(e,r){super(e,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:P()})}getOptimisticResult(e){return e.behavior=P(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,r){var m,v;const{state:s}=e,n=super.createResult(e,r),{isFetching:o,isRefetching:i,isError:g,isRefetchError:c}=n,d=(v=(m=s.fetchMeta)==null?void 0:m.fetchMore)==null?void 0:v.direction,h=g&&d==="forward",x=o&&d==="forward",f=g&&d==="backward",b=o&&d==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:S(r,s.data),hasPreviousPage:L(r,s.data),isFetchNextPageError:h,isFetchingNextPage:x,isFetchPreviousPageError:f,isFetchingPreviousPage:b,isRefetchError:c&&!h&&!f,isRefetching:i&&!x&&!b}}};function V(e,r){return H(e,z)}function J({title:e,titleId:r,...s},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},s),e?l.createElement("title",{id:r},e):null,l.createElement("path",{d:"M4.913 2.658c2.075-.27 4.19-.408 6.337-.408 2.147 0 4.262.139 6.337.408 1.922.25 3.291 1.861 3.405 3.727a4.403 4.403 0 0 0-1.032-.211 50.89 50.89 0 0 0-8.42 0c-2.358.196-4.04 2.19-4.04 4.434v4.286a4.47 4.47 0 0 0 2.433 3.984L7.28 21.53A.75.75 0 0 1 6 21v-4.03a48.527 48.527 0 0 1-1.087-.128C2.905 16.58 1.5 14.833 1.5 12.862V6.638c0-1.97 1.405-3.718 3.413-3.979Z"}),l.createElement("path",{d:"M15.75 7.5c-1.376 0-2.739.057-4.086.169C10.124 7.797 9 9.103 9 10.609v4.285c0 1.507 1.128 2.814 2.67 2.94 1.243.102 2.5.157 3.768.165l2.782 2.781a.75.75 0 0 0 1.28-.53v-2.39l.33-.026c1.542-.125 2.67-1.433 2.67-2.94v-4.286c0-1.505-1.125-2.811-2.664-2.94A49.392 49.392 0 0 0 15.75 7.5Z"}))}const W=l.forwardRef(J);function X({title:e,titleId:r,...s},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},s),e?l.createElement("title",{id:r},e):null,l.createElement("path",{fillRule:"evenodd",d:"M18.97 3.659a2.25 2.25 0 0 0-3.182 0l-10.94 10.94a3.75 3.75 0 1 0 5.304 5.303l7.693-7.693a.75.75 0 0 1 1.06 1.06l-7.693 7.693a5.25 5.25 0 1 1-7.424-7.424l10.939-10.94a3.75 3.75 0 1 1 5.303 5.304L9.097 18.835l-.008.008-.007.007-.002.002-.003.002A2.25 2.25 0 0 1 5.91 15.66l7.81-7.81a.75.75 0 0 1 1.061 1.06l-7.81 7.81a.75.75 0 0 0 1.054 1.068L18.97 6.84a2.25 2.25 0 0 0 0-3.182Z",clipRule:"evenodd"}))}const Y=l.forwardRef(X),ee=({avatar:e=null})=>t.jsxs(t.Fragment,{children:[e&&t.jsx("div",{className:"chat-image avatar",children:t.jsx("div",{className:"rounded-full w-8",children:t.jsx("img",{src:e})})}),!e&&t.jsx("div",{className:"avatar avatar-placeholder",children:t.jsx("div",{className:"\n                bg-gray-400 text-gray-800 rounded-full w-8\n                dark:bg-gray-700 dark:text-gray-100\n            ",children:t.jsx("span",{className:"text-xl",children:t.jsx(B,{className:"w-4"})})})})]}),te=({conversation:e,selectedConversation:r=null,online:s=null})=>{const o=_().props.auth.user;let i=" border-transparent";return r&&r.id===e.id&&r.is_group===e.is_group&&(i="border-blue-500 bg-blue-50 dark:bg-gray-700/50 shadow-sm"),t.jsxs(C,{href:e.is_group?route("chat.group",e):route("chat.user",e),preserveState:!0,className:"conversation-item flex items-center justify-between gap-3 rounded-md p-3 transition-all cursor-pointer border  text-gray-800 hover:hover:bg-blue-50 dark:text-gray-200 dark:hover:bg-gray-700 "+i+(!e.is_group&&o.role==="admin"?" pr-2":" pr-4"),children:[!e.is_group&&t.jsx(T,{user:e,online:s}),e.is_group&&t.jsx(ee,{avatar:e.avatar}),t.jsxs("div",{className:"flex-1 text-xs max-w-full overflow-hidden",children:[t.jsx("div",{className:"flex gap-1 justify-between items-center",children:t.jsx("h3",{className:"text-sm font-semibold truncate",children:e.name})}),e.last_message_date&&(e.last_message?t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 text-nowrap truncate",children:e.last_message}):t.jsxs("p",{className:"text-xs text-gray-600 flex items-center justify-start gap-1 dark:text-gray-400 text-nowrap truncate",children:[t.jsx(Y,{className:"w-3"})," Sent an attachment"]}))]}),t.jsxs("div",{className:"flex text-xs flex-col items-center justify-center gap-1",children:[e.last_message_date&&t.jsx("span",{className:"text-nowrap  text-gray-500 dark:text-gray-400",children:$(e.last_message_date)}),e.unread_count>0&&t.jsx("span",{className:"py-1 px-2 rounded-full bg-blue-500 dark:text-black text-white",children:e.unread_count>99?"99+":e.unread_count})]})]})},re=async({page:e=1,search:r=""})=>{const{data:s}=await Z.get("/conversations",{params:{page:e,search:r}});return(s==null?void 0:s.data)||null},se=(e={})=>V({queryKey:["conversations",e],queryFn:({pageParam:r=1})=>re({page:r,...e}),getNextPageParam:r=>{const s=r.meta.current_page,n=r.meta.last_page;return s<n?s+1:void 0}}),ae=A((e,r)=>({onlineUsers:{},setOnlineUsers:s=>e({onlineUsers:s}),addOnlineUser:s=>e(n=>({onlineUsers:{...n.onlineUsers,[s.id]:s}})),removeOnlineUser:s=>e(n=>{const o={...n.onlineUsers};return delete o[s],{onlineUsers:o}}),isUserOnline:s=>!!r().onlineUsers[s]}));function ne(){const{t:e}=K("sidebar"),r=_(),{data:s,fetchNextPage:n,hasNextPage:o,isFetchingNextPage:i,status:g,isLoading:c}=se(),d=l.useMemo(()=>(s==null?void 0:s.pages.flatMap(a=>a.data))||[],[s]),h=p(a=>a.setConversations),x=p(a=>a.updateConversation),f=p(a=>a.searchConversations),b=p(a=>a.updateConversationOnDelete),w=p(a=>a.conversations),m=r.props.auth,{setOnlineUsers:v,addOnlineUser:O,removeOnlineUser:R,isUserOnline:E}=ae(),U=r.props.selectedConversation,{on:j}=D(),N=l.useRef(0);l.useEffect(()=>{c||d.length!==0&&d.length!==N.current&&(N.current=d.length,h(d))},[d,c]);const k=l.useRef(null);l.useEffect(()=>{if(!o||i)return;const a=new IntersectionObserver(y=>{y[0].isIntersecting&&n()},{threshold:1}),u=k.current;return u&&a.observe(u),()=>u&&a.unobserve(u)},[o,i,n]);const F=a=>{x(a,m.user.id)},M=({prevMessage:a})=>{b(a)};return l.useEffect(()=>{const a=j("message.created",F),u=j("message.deleted",M);return()=>{a(),u()}},[j]),l.useEffect(()=>(Echo.join("online").here(a=>{const u=Object.fromEntries(a.map(y=>[y.id,y]));v(u)}).joining(a=>{O(a)}).leaving(a=>{R(a.id)}).error(a=>{}),()=>{Echo.leave("online")}),[]),{t:e,isUserOnline:E,selectedConversation:U,conversations:w,onSearch:a=>{f(a.target.value.toLowerCase())},auth:m,isLoading:c,loadMoreRef:k,isFetchingNextPage:i,hasNextPage:o}}const le=({children:e})=>{const{t:r,isUserOnline:s,selectedConversation:n,conversations:o,onSearch:i,auth:g,isLoading:c,loadMoreRef:d,isFetchingNextPage:h,hasNextPage:x}=ne();return t.jsxs(t.Fragment,{children:[t.jsx(I,{title:"All Chats"}),t.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[t.jsxs("div",{className:"transition-all \n                                    w-full sm:w-[300px] \n                                    bg-gradient-to-b from-blue-50 to-white \n                                    dark:from-slate-800 dark:to-slate-900 \n                                    flex min-h-0 flex-col overflow-hidden \n                                    border-r border-gray-200 dark:border-slate-700 shadow-sm\n                                    ".concat(n?"-ml-[100%] md:ml-0 lg:ml-0":"ml-0"),children:[t.jsxs("div",{className:"flex items-center justify-between py-3 px-4 text-lg font-semibold \n                                    text-gray-700 dark:text-gray-100 border-b border-gray-200 dark:border-slate-700",children:[r("title"),g.user.role==="admin"&&t.jsx("div",{className:"tooltip tooltip-left","data-tip":r("tooltip.createGroup"),children:t.jsx(C,{href:route("group.create"),className:"text-blue-500 hover:text-blue-700 dark:text-indigo-400 dark:hover:text-indigo-300",children:t.jsx(Q,{className:"w-7 h-7 inline-block ml-2"})})})]}),t.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-slate-700",children:t.jsx(G,{onKeyUp:i,placeholder:r("searchPlaceholder"),className:"w-full bg-white/70 dark:bg-slate-700 \n                                text-gray-800 dark:text-gray-100 \n                                placeholder-gray-400 dark:placeholder-gray-300 \n                                border border-gray-300 dark:border-slate-600 \n                                focus:ring focus:ring-blue-400 focus:border-blue-400 rounded-lg "})}),c?[1,2,3,4].map(f=>t.jsx(ie,{},f)):t.jsx(oe,{sortedConversations:o,t:r,selectedConversation:n,isUserOnline:s,loadMoreRef:d,hasNextPage:x,isFetchingNextPage:h})]}),t.jsx("div",{className:"w-full flex-1 mx-auto flex flex-col overflow-x-hidden overflow-y-auto bg-gray-50 dark:bg-slate-900 text-gray-800 dark:text-gray-100",children:e})]})]})},oe=({sortedConversations:e,t:r,selectedConversation:s,isUserOnline:n,loadMoreRef:o,isFetchingNextPage:i,hasNextPage:g})=>t.jsxs("div",{className:"hide-scrollbar flex-1 overflow-y-auto px-2 pt-1 pb-5 space-y-1",children:[e&&e.map(c=>t.jsx(te,{conversation:c,selectedConversation:s,online:n(c.receiver_id)},"".concat(c.is_group?"group_":"chat_").concat(c.id))),g&&t.jsx("div",{ref:o,className:"h-6"}),i&&t.jsx("div",{className:"text-center text-sm text-gray-500 py-2",children:"Loading more..."}),(e==null?void 0:e.length)===0&&t.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-6",children:[t.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4",children:t.jsx(W,{className:"h-12 w-12 text-gray-400"})}),t.jsx("h2",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:r("noConversations.title")}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2 max-w-sm",children:r("noConversations.message")})]})]}),ie=()=>t.jsxs("div",{className:"conversation-item flex items-center justify-between gap-3 rounded-md p-3 border border-transparent text-gray-800 dark:text-gray-200 animate-pulse",children:[t.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded-full"}),t.jsxs("div",{className:"flex-1 text-xs max-w-full overflow-hidden",children:[t.jsxs("div",{className:"flex gap-1 justify-between items-center",children:[t.jsx("div",{className:"h-3 w-2/3 bg-gray-200 dark:bg-gray-700 rounded"}),t.jsx("div",{className:"h-3 w-10 bg-gray-200 dark:bg-gray-700 rounded"})]}),t.jsx("div",{className:"mt-2 h-3 w-5/6 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),be=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"}));export{le as C,Y as F,ee as G,W as a,be as b,ae as u};
