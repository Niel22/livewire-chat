import{j as o,k as p}from"./app-BIvaOuEf.js";const C=({user:i,online:u=null,profile:t=!1})=>{let e="";u===!0?e="avatar-online":u===!1&&(e="avatar-offline");const s=t?"w-40":"w-8";return o.jsxs(o.Fragment,{children:[i.avatar&&o.jsx("div",{className:"chat-image avatar ".concat(e),children:o.jsx("div",{className:"rounded-full ".concat(s),children:o.jsx("img",{src:i.avatar})})}),!i.avatar&&o.jsx("div",{className:"chat-image avatar avatar-placeholder ".concat(e),children:o.jsx("div",{className:"rounded-full ".concat(s,"\n                    bg-gray-400 text-gray-800 \n                    dark:bg-gray-700 dark:text-gray-100"),children:o.jsx("span",{className:"text-xl",children:i.name.substring(0,1)})})})]})},x=p((i,u)=>({conversations:[],allConversations:null,setConversations:t=>{const e=[...t].filter(s=>s.is_group||s.last_message_date!==null).sort((s,r)=>s.last_message_date&&r.last_message_date?new Date(r.last_message_date)-new Date(s.last_message_date):s.last_message_date?-1:r.last_message_date?1:0);i({conversations:e,allConversations:e})},updateConversation:(t,e)=>{i(s=>({conversations:s.conversations.map(a=>{var c,m,g;const d=t.conversation_id&&!a.is_group&&a.id===+t.conversation_id,l=t.group_id&&a.is_group&&a.id===+t.group_id,_=parseInt(t.sender_id)===parseInt(e);return d?{...a,last_message:t.message,last_message_date:t.created_at,unread_count:_?0:((c=a.unread_count)!=null?c:0)+1}:l?{...a,last_message:t.message,last_message_date:t.created_at,unread_count:_?0:((m=a.unread_count)!=null?m:0)+1}:((d||l)&&"Notification"in window&&Notification.permission==="granted"&&t.sender_id!==e&&(new Notification("New Message",{body:(g=t.message)!=null?g:"Sent an Attachment"}),new Audio("/notify.wav").play().catch(f=>console.warn("Unable to play notification sound:",f))),a)}).sort((a,d)=>{const l=new Date(a.last_message_date||0);return new Date(d.last_message_date||0)-l})}))},updateConversationOnDelete:t=>{i(e=>({conversations:e.conversations.map(n=>{const a=t.conversation_id&&!n.is_group&&n.id===+t.conversation_id,d=t.group_id&&n.is_group&&n.id===+t.group_id;return a||d?{...n,last_message:t.message,last_message_date:t.created_at}:n}).sort((n,a)=>{const d=new Date(n.last_message_date||0);return new Date(a.last_message_date||0)-d})}))},searchConversations:t=>{const{allConversations:e}=u();if(!t){i({conversations:e});return}const s=t.toLowerCase(),r=e.filter(n=>{const a=(n.is_group,n.name);return a==null?void 0:a.toLowerCase().includes(s)});i({conversations:r})},resetUnreadCount:(t,e=!1)=>{i(s=>({conversations:s.conversations.map(r=>(e?r.is_group&&r.id===+t:!r.is_group&&r.id===+t)?{...r,unread_count:0}:r)}))}}));export{C as U,x as u};
