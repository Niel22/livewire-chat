import{r as n,j as r,e as x,L as h,c as D,H as L}from"./app-mmQtLiQg.js";import{U as F}from"./UserAvatar-B0UTbXI6.js";import{F as E}from"./UserGroupIcon-DPm-w3X4.js";import{T as S}from"./TextInput-CPQMZB1M.js";function R({title:e,titleId:t,...s},i){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{d:"M4.913 2.658c2.075-.27 4.19-.408 6.337-.408 2.147 0 4.262.139 6.337.408 1.922.25 3.291 1.861 3.405 3.727a4.403 4.403 0 0 0-1.032-.211 50.89 50.89 0 0 0-8.42 0c-2.358.196-4.04 2.19-4.04 4.434v4.286a4.47 4.47 0 0 0 2.433 3.984L7.28 21.53A.75.75 0 0 1 6 21v-4.03a48.527 48.527 0 0 1-1.087-.128C2.905 16.58 1.5 14.833 1.5 12.862V6.638c0-1.97 1.405-3.718 3.413-3.979Z"}),n.createElement("path",{d:"M15.75 7.5c-1.376 0-2.739.057-4.086.169C10.124 7.797 9 9.103 9 10.609v4.285c0 1.507 1.128 2.814 2.67 2.94 1.243.102 2.5.157 3.768.165l2.782 2.781a.75.75 0 0 0 1.28-.53v-2.39l.33-.026c1.542-.125 2.67-1.433 2.67-2.94v-4.286c0-1.505-1.125-2.811-2.664-2.94A49.392 49.392 0 0 0 15.75 7.5Z"}))}const U=n.forwardRef(R);function Y({title:e,titleId:t,...s},i){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{fillRule:"evenodd",d:"M18.97 3.659a2.25 2.25 0 0 0-3.182 0l-10.94 10.94a3.75 3.75 0 1 0 5.304 5.303l7.693-7.693a.75.75 0 0 1 1.06 1.06l-7.693 7.693a5.25 5.25 0 1 1-7.424-7.424l10.939-10.94a3.75 3.75 0 1 1 5.303 5.304L9.097 18.835l-.008.008-.007.007-.002.002-.003.002A2.25 2.25 0 0 1 5.91 15.66l7.81-7.81a.75.75 0 0 1 1.061 1.06l-7.81 7.81a.75.75 0 0 0 1.054 1.068L18.97 6.84a2.25 2.25 0 0 0 0-3.182Z",clipRule:"evenodd"}))}const A=n.forwardRef(Y);function B({title:e,titleId:t,...s},i){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},s),e?n.createElement("title",{id:t},e):null,n.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z",clipRule:"evenodd"}))}const M=n.forwardRef(B),O=()=>r.jsx(r.Fragment,{children:r.jsx("div",{className:"avatar avatar-placeholder",children:r.jsx("div",{className:`
                bg-gray-400 text-gray-800 rounded-full w-8
                dark:bg-gray-700 dark:text-gray-100
            `,children:r.jsx("span",{className:"text-xl",children:r.jsx(E,{className:"w-4"})})})})}),q=e=>{const t=new Date,s=new Date(e);return w(s)?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):y(s)?"Yesterday "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.getFullYear()===t.getFullYear()?s.toLocaleTimeString([],{day:"2-digit",month:"short"}):s.toLocaleDateString()},I=e=>{const t=new Date,s=new Date(e);return w(s)?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):y(s)?"Yesterday":s.getFullYear()===t.getFullYear()?s.toLocaleDateString([],{day:"2-digit",month:"short"}):s.toLocaleDateString()},w=e=>{const t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},y=e=>{const t=new Date;return t.setDate(t.getDate()-1),e.getDate()===t.getDate&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},T=e=>{let t=e.mime||e.type;return t=t.split("/"),t[0].toLowerCase()==="image"},$=e=>{let t=e.mime||e.type;return t=t.split("/"),t[0].toLowerCase()==="video"},P=e=>{let t=e.mime||e.type;return t=t.split("/"),t[0].toLowerCase()==="audio"},Z=e=>(e.mime||e.type).toLowerCase()==="application/pdf",Q=e=>T(e)||$(e)||P(e)||Z(e),W=(e,t=2)=>{if(e===0)return"0 bytes";const s=1024,i=t<0?0:t,u=["Bytes","KB","MB","GB"];let d=0,c=e;for(;c>=s;)c/=s,d++;return parseFloat(c.toFixed(i))+" "+u[d]};async function X(e){try{return(await axios.get(`/messages/${e}`)).data}catch(t){return console.error("Failed to fetch message",t),null}}const G=({conversation:e,selectedConversation:t=null,online:s=null})=>{const u=x().props.auth.user;let d=" border-transparent";return t&&t.id===e.id&&t.is_group===e.is_group&&(d="border-blue-500 bg-blue-50 dark:bg-gray-700/50 shadow-sm"),r.jsxs(h,{href:e.is_group?route("chat.group",e):route("chat.user",e),preserveState:!0,className:"conversation-item flex items-center justify-between gap-3 rounded-md p-3 transition-all cursor-pointer border  text-gray-800 hover:hover:bg-blue-50 dark:text-gray-200 dark:hover:bg-gray-700 "+d+(!e.is_group&&u.role==="admin"?" pr-2":" pr-4"),children:[!e.is_group&&r.jsx(F,{user:e,online:s}),e.is_group&&r.jsx(O,{}),r.jsxs("div",{className:"flex-1 text-xs max-w-full overflow-hidden",children:[r.jsxs("div",{className:"flex gap-1 justify-between items-center",children:[r.jsx("h3",{className:"text-sm font-semibold truncate",children:e.name}),e.last_message_date&&r.jsx("span",{className:"text-nowrap text-gray-500 dark:text-gray-400",children:I(e.last_message_date)})]}),e.last_message_date&&(e.last_message?r.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 text-nowrap truncate",children:e.last_message}):r.jsxs("p",{className:"text-xs text-gray-600 flex items-center justify-start gap-1 dark:text-gray-400 text-nowrap truncate",children:[r.jsx(A,{className:"w-3"})," Sent an attachment"]}))]})]})},H=({children:e})=>{const t=x(),s=t.props.auth,i=t.props.conversations,u=t.props.selectedConversation,[d,c]=n.useState([]),[g,b]=n.useState([]),{on:m}=D(),[_,f]=n.useState({}),j=a=>_[a];n.useEffect(()=>{c(i)},[i]);const v=a=>{c(l=>l.map(o=>a.conversation_id&&!o.is_group&&o.id===parseInt(a.conversation_id)?("Notification"in window&&Notification.permission==="granted"&&a.sender_id!==s.user.id&&(new Notification("New Message",{body:a.message??"Sent an Attachment"}),new Audio("/notify.wav").play().catch(p=>{console.warn("Unable to play notification sound automatically:",p)})),{...o,last_message:a.message,last_message_date:a.created_at}):a.group_id&&o.is_group&&o.id===parseInt(a.group_id)?("Notification"in window&&Notification.permission==="granted"&&a.sender_id!==s.user.id&&(new Notification("New Message",{body:a.message??"Sent an Attachment"}),new Audio("/notify.wav").play().catch(p=>{console.warn("Unable to play notification sound automatically:",p)})),{...o,last_message:a.message,last_message_date:a.created_at}):o))},N=({prevMessage:a})=>{c(l=>l.map(o=>a.conversation_id&&!o.is_group&&o.id===parseInt(a.conversation_id)?{...o,last_message:a.message,last_message_date:a.created_at}:a.group_id&&o.is_group&&o.id===parseInt(a.group_id)?{...o,last_message:a.message,last_message_date:a.created_at}:o))};n.useEffect(()=>{const a=m("message.created",v),l=m("message.deleted",N);return()=>{a(),l()}},[m]),n.useEffect(()=>{b(d.sort((a,l)=>a.last_message_date&&l.last_message_date?new Date(l.last_message_date)-new Date(a.last_message_date):a.last_message_date?-1:l.last_message_date?1:0))},[d]),n.useEffect(()=>(Echo.join("online").here(a=>{const l=Object.fromEntries(a.map(o=>[o.id,o]));f(o=>({...o,...l}))}).joining(a=>{f(l=>{const o={...l};return o[a.id]=a,o})}).leaving(a=>{f(l=>{const o={...l};return delete o[a.id],o})}).error(a=>{console.log("errors",a)}),()=>{Echo.leave("online")}),[]);const k=a=>{const l=a.target.value.toLowerCase();c(i.filter(o=>o.name.toLowerCase().includes(l)))};return r.jsxs(r.Fragment,{children:[r.jsx(L,{title:"All Chats"}),r.jsxs("div",{className:"flex-1 w-full flex overflow-hidden",children:[r.jsxs("div",{className:`transition-all 
                                    w-full sm:w-[220px] md:w-[300px] 
                                    bg-gradient-to-b from-blue-50 to-white 
                                    dark:from-slate-800 dark:to-slate-900 
                                    flex flex-col overflow-hidden 
                                    border-r border-gray-200 dark:border-slate-700 shadow-sm
                                    ${u?"-ml-[100%] sm:ml-0 lg:ml-0":"ml-0"}`,children:[r.jsxs("div",{className:`flex items-center justify-between py-3 px-4 text-lg font-semibold 
                                    text-gray-700 dark:text-gray-100 border-b border-gray-200 dark:border-slate-700`,children:["My Conversations",s.user.role==="admin"&&r.jsx("div",{className:"tooltip tooltip-left","data-tip":"Create New Group",children:r.jsx(h,{href:route("group.create"),className:"text-blue-500 hover:text-blue-700 dark:text-indigo-400 dark:hover:text-indigo-300",children:r.jsx(M,{className:"w-7 h-7 inline-block ml-2"})})})]}),r.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-slate-700",children:r.jsx(S,{onKeyUp:k,placeholder:"Filter users and groups",className:`w-full bg-white/70 dark:bg-slate-700 
                                text-gray-800 dark:text-gray-100 
                                placeholder-gray-400 dark:placeholder-gray-300 
                                border border-gray-300 dark:border-slate-600 
                                focus:ring focus:ring-blue-400 focus:border-blue-400 rounded-lg `})}),r.jsxs("div",{className:"hide-scrollbar flex-1 overflow-auto px-2 pt-1 pb-5 space-y-1",children:[g&&g.map(a=>r.jsx(G,{conversation:a,selectedConversation:u,online:!!j(a.id)},`${a.is_group?"group_":"chat_"}${a.id}`)),g.length===0&&r.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-6",children:[r.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4",children:r.jsx(U,{className:"h-12 w-12 text-gray-400"})}),r.jsx("h2",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:"No Conversations"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2 max-w-sm",children:"You are not in any group yet or havenâ€™t started a chat. Join a group or create a new one to begin chatting."})]})]})]}),r.jsx("div",{className:"flex-1 flex flex-col min-w-0 overflow-hidden overflow-y-auto bg-gray-50 dark:bg-slate-900 text-gray-800 dark:text-gray-100",children:e})]})]})},ee=Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"}));export{H as C,A as F,O as G,$ as a,P as b,Z as c,Q as d,W as e,q as f,U as g,X as h,T as i,ee as j};
