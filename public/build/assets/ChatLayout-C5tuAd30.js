import{r as l,j as a,c as x,L as h,b as C,H as L}from"./app-LiaMH4oY.js";import{U as F}from"./UserAvatar-__KyTCrJ.js";import{F as S}from"./UserGroupIcon-CB8t8nWJ.js";import{T as E}from"./TextInput-VIUZjcMk.js";function U({title:e,titleId:t,...o},i){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},o),e?l.createElement("title",{id:t},e):null,l.createElement("path",{fillRule:"evenodd",d:"M18.97 3.659a2.25 2.25 0 0 0-3.182 0l-10.94 10.94a3.75 3.75 0 1 0 5.304 5.303l7.693-7.693a.75.75 0 0 1 1.06 1.06l-7.693 7.693a5.25 5.25 0 1 1-7.424-7.424l10.939-10.94a3.75 3.75 0 1 1 5.303 5.304L9.097 18.835l-.008.008-.007.007-.002.002-.003.002A2.25 2.25 0 0 1 5.91 15.66l7.81-7.81a.75.75 0 0 1 1.061 1.06l-7.81 7.81a.75.75 0 0 0 1.054 1.068L18.97 6.84a2.25 2.25 0 0 0 0-3.182Z",clipRule:"evenodd"}))}const Y=l.forwardRef(U);function R({title:e,titleId:t,...o},i){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},o),e?l.createElement("title",{id:t},e):null,l.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z",clipRule:"evenodd"}))}const A=l.forwardRef(R),B=()=>a.jsx(a.Fragment,{children:a.jsx("div",{className:"avatar avatar-placeholder",children:a.jsx("div",{className:`
                bg-gray-400 text-gray-800 rounded-full w-8
                dark:bg-gray-700 dark:text-gray-100
            `,children:a.jsx("span",{className:"text-xl",children:a.jsx(S,{className:"w-4"})})})})}),K=e=>{const t=new Date,o=new Date(e);return w(o)?o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):y(o)?"Yesterday "+o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):o.getFullYear()===t.getFullYear()?o.toLocaleTimeString([],{day:"2-digit",month:"short"}):o.toLocaleDateString()},I=e=>{const t=new Date,o=new Date(e);return w(o)?o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):y(o)?"Yesterday":o.getFullYear()===t.getFullYear()?o.toLocaleDateString([],{day:"2-digit",month:"short"}):o.toLocaleDateString()},w=e=>{const t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},y=e=>{const t=new Date;return t.setDate(t.getDate()-1),e.getDate()===t.getDate&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},M=e=>{let t=e.mime||e.type;return t=t.split("/"),t[0].toLowerCase()==="image"},O=e=>{let t=e.mime||e.type;return t=t.split("/"),t[0].toLowerCase()==="video"},T=e=>{let t=e.mime||e.type;return t=t.split("/"),t[0].toLowerCase()==="audio"},$=e=>(e.mime||e.type).toLowerCase()==="application/pdf",q=e=>M(e)||O(e)||T(e)||$(e),J=(e,t=2)=>{if(e===0)return"0 bytes";const o=1024,i=t<0?0:t,u=["Bytes","KB","MB","GB"];let d=0,c=e;for(;c>=o;)c/=o,d++;return parseFloat(c.toFixed(i))+" "+u[d]};async function Q(e){try{return(await axios.get(`/messages/${e}`)).data}catch(t){return console.error("Failed to fetch message",t),null}}const P=({conversation:e,selectedConversation:t=null,online:o=null})=>{const u=x().props.auth.user;let d=" border-transparent";return t&&t.id===e.id&&t.is_group===e.is_group&&(d="border-blue-500 bg-blue-50 dark:bg-gray-700/50 shadow-sm"),a.jsxs(h,{href:e.is_group?route("chat.group",e):route("chat.user",e),preserveState:!0,className:"conversation-item flex items-center justify-between gap-3 rounded-md p-3 transition-all cursor-pointer border  text-gray-800 hover:hover:bg-blue-50 dark:text-gray-200 dark:hover:bg-gray-700 "+d+(!e.is_group&&u.role==="admin"?" pr-2":" pr-4"),children:[!e.is_group&&a.jsx(F,{user:e,online:o}),e.is_group&&a.jsx(B,{}),a.jsxs("div",{className:"flex-1 text-xs max-w-full overflow-hidden",children:[a.jsxs("div",{className:"flex gap-1 justify-between items-center",children:[a.jsx("h3",{className:"text-sm font-semibold truncate",children:e.name}),e.last_message_date&&a.jsx("span",{className:"text-nowrap text-gray-500 dark:text-gray-400",children:I(e.last_message_date)})]}),e.last_message_date&&(e.last_message?a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 text-nowrap truncate",children:e.last_message}):a.jsxs("p",{className:"text-xs text-gray-600 flex items-center justify-start gap-1 dark:text-gray-400 text-nowrap truncate",children:[a.jsx(Y,{className:"w-3"})," Sent an attachment"]}))]})]})},G=({children:e})=>{const t=x(),o=t.props.auth,i=t.props.conversations,u=t.props.selectedConversation,[d,c]=l.useState([]),[p,_]=l.useState([]),{on:g}=C(),[b,m]=l.useState({}),j=r=>b[r];l.useEffect(()=>{c(i)},[i]);const v=r=>{c(n=>n.map(s=>r.conversation_id&&!s.is_group&&s.id===parseInt(r.conversation_id)?("Notification"in window&&Notification.permission==="granted"&&r.sender_id!==o.user.id&&(new Notification("New Message",{body:r.message??"Sent an Attachment"}),new Audio("/notify.wav").play().catch(f=>{console.warn("Unable to play notification sound automatically:",f)})),{...s,last_message:r.message,last_message_date:r.created_at}):r.group_id&&s.is_group&&s.id===parseInt(r.group_id)?("Notification"in window&&Notification.permission==="granted"&&r.sender_id!==o.user.id&&(new Notification("New Message",{body:r.message??"Sent an Attachment"}),new Audio("/notify.wav").play().catch(f=>{console.warn("Unable to play notification sound automatically:",f)})),{...s,last_message:r.message,last_message_date:r.created_at}):s))},N=({prevMessage:r})=>{c(n=>n.map(s=>r.conversation_id&&!s.is_group&&s.id===parseInt(r.conversation_id)?{...s,last_message:r.message,last_message_date:r.created_at}:r.group_id&&s.is_group&&s.id===parseInt(r.group_id)?{...s,last_message:r.message,last_message_date:r.created_at}:s))};l.useEffect(()=>{const r=g("message.created",v),n=g("message.deleted",N);return()=>{r(),n()}},[g]),l.useEffect(()=>{_(d.sort((r,n)=>r.last_message_date&&n.last_message_date?new Date(n.last_message_date)-new Date(r.last_message_date):r.last_message_date?-1:n.last_message_date?1:0))},[d]),l.useEffect(()=>(Echo.join("online").here(r=>{const n=Object.fromEntries(r.map(s=>[s.id,s]));m(s=>({...s,...n}))}).joining(r=>{m(n=>{const s={...n};return s[r.id]=r,s})}).leaving(r=>{m(n=>{const s={...n};return delete s[r.id],s})}).error(r=>{console.log("errors",r)}),()=>{Echo.leave("online")}),[]);const k=r=>{const n=r.target.value.toLowerCase();c(i.filter(s=>s.name.toLowerCase().includes(n)))};return a.jsxs(a.Fragment,{children:[a.jsx(L,{title:"All Chats"}),a.jsxs("div",{className:"flex-1 w-full flex overflow-hidden",children:[a.jsxs("div",{className:`transition-all w-full sm:w-[220px] md:w-[300px] 
                                bg-gradient-to-b from-blue-50 to-white 
                                dark:from-slate-800 dark:to-slate-900 
                                flex flex-col overflow-hidden 
                                border-r border-gray-200 dark:border-slate-700 shadow-sm
                                ${u?"-ml-[100%] sm:ml-0":""}`,children:[a.jsxs("div",{className:`flex items-center justify-between py-3 px-4 text-lg font-semibold 
                                    text-gray-700 dark:text-gray-100 border-b border-gray-200 dark:border-slate-700`,children:["My Conversations",a.jsx("div",{className:"tooltip tooltip-left","data-tip":"Create New Group",children:a.jsx(h,{href:route("group.create"),className:"text-blue-500 hover:text-blue-700 dark:text-indigo-400 dark:hover:text-indigo-300",children:a.jsx(A,{className:"w-7 h-7 inline-block ml-2"})})})]}),a.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-slate-700",children:a.jsx(E,{onKeyUp:k,placeholder:"Filter users and groups",className:`w-full bg-white/70 dark:bg-slate-700 
                                text-gray-800 dark:text-gray-100 
                                placeholder-gray-400 dark:placeholder-gray-300 
                                border border-gray-300 dark:border-slate-600 
                                focus:ring focus:ring-blue-400 focus:border-blue-400 rounded-lg `})}),a.jsx("div",{className:"hide-scrollbar flex-1 overflow-auto px-2 pt-1 pb-5 space-y-1",children:p&&p.map(r=>a.jsx(P,{conversation:r,selectedConversation:u,online:!!j(r.id)},`${r.is_group?"group_":"chat_"}${r.id}`))})]}),a.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto bg-gray-50 dark:bg-slate-900 text-gray-800 dark:text-gray-100",children:e})]})]})},W=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));export{G as C,Y as F,B as G,O as a,T as b,$ as c,q as d,J as e,K as f,Q as g,W as h,M as i};
