System.register(["./app-legacy-Z1_F-9fD.js"],function(e,a){"use strict";var s,t;return{setters:[e=>{s=e.j,t=e.k}],execute:function(){e("U",({user:e,online:a=null,profile:t=!1})=>{let n="";!0===a?n="avatar-online":!1===a&&(n="avatar-offline");const r=t?"w-40":"w-8";return s.jsxs(s.Fragment,{children:[e.avatar&&s.jsx("div",{className:`chat-image avatar ${n}`,children:s.jsx("div",{className:`rounded-full ${r}`,children:s.jsx("img",{src:e.avatar})})}),!e.avatar&&s.jsx("div",{className:`chat-image avatar avatar-placeholder ${n}`,children:s.jsx("div",{className:`rounded-full ${r}\n                    bg-gray-400 text-gray-800 \n                    dark:bg-gray-700 dark:text-gray-100`,children:s.jsx("span",{className:"text-xl",children:e.name.substring(0,1)})})})]})}),e("u",t((e,a)=>({conversations:[],allConversations:null,setConversations:a=>{const s=[...a].filter(e=>e.is_group||null!==e.last_message_date).sort((e,a)=>e.last_message_date&&a.last_message_date?new Date(a.last_message_date)-new Date(e.last_message_date):e.last_message_date?-1:a.last_message_date?1:0);e({conversations:s,allConversations:s})},updateConversation:(a,s)=>{e(e=>({conversations:e.conversations.map(e=>{const t=a.conversation_id&&!e.is_group&&e.id===+a.conversation_id,n=a.group_id&&e.is_group&&e.id===+a.group_id,r=parseInt(a.sender_id)===parseInt(s);return t||n?{...e,last_message:a.message,last_message_date:a.created_at,unread_count:r?0:(e.unread_count??0)+1}:((t||n)&&"Notification"in window&&"granted"===Notification.permission&&a.sender_id!==s&&(new Notification("New Message",{body:a.message??"Sent an Attachment"}),new Audio("/notify.wav").play().catch(e=>console.warn("Unable to play notification sound:",e))),e)}).sort((e,a)=>{const s=new Date(e.last_message_date||0);return new Date(a.last_message_date||0)-s})}))},updateConversationOnDelete:a=>{e(e=>({conversations:e.conversations.map(e=>{const s=a.conversation_id&&!e.is_group&&e.id===+a.conversation_id,t=a.group_id&&e.is_group&&e.id===+a.group_id;return s||t?{...e,last_message:a.message,last_message_date:a.created_at}:e}).sort((e,a)=>{const s=new Date(e.last_message_date||0);return new Date(a.last_message_date||0)-s})}))},searchConversations:s=>{const{allConversations:t}=a();if(!s)return void e({conversations:t});const n=s.toLowerCase(),r=t.filter(e=>{const a=(e.is_group,e.name);return a?.toLowerCase().includes(n)});e({conversations:r})},resetUnreadCount:(a,s=!1)=>{e(e=>({conversations:e.conversations.map(e=>(s?e.is_group&&e.id===+a:!e.is_group&&e.id===+a)?{...e,unread_count:0}:e)}))}})))}}});
