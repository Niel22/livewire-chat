import{r as s,j as t,c as p,L as h,b as k,H as C}from"./app-BIPxN0Nk.js";import{k as E}from"./helpers-SYRP98BK.js";import{F as R}from"./UserGroupIcon-zfOyYe_X.js";import{U as S}from"./UserAvatar-704F6-Ac.js";import{T as U}from"./TextInput-nlxt7iRX.js";function L({title:a,titleId:n,...o},d){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":n},o),a?s.createElement("title",{id:n},a):null,s.createElement("path",{d:"M4.913 2.658c2.075-.27 4.19-.408 6.337-.408 2.147 0 4.262.139 6.337.408 1.922.25 3.291 1.861 3.405 3.727a4.403 4.403 0 0 0-1.032-.211 50.89 50.89 0 0 0-8.42 0c-2.358.196-4.04 2.19-4.04 4.434v4.286a4.47 4.47 0 0 0 2.433 3.984L7.28 21.53A.75.75 0 0 1 6 21v-4.03a48.527 48.527 0 0 1-1.087-.128C2.905 16.58 1.5 14.833 1.5 12.862V6.638c0-1.97 1.405-3.718 3.413-3.979Z"}),s.createElement("path",{d:"M15.75 7.5c-1.376 0-2.739.057-4.086.169C10.124 7.797 9 9.103 9 10.609v4.285c0 1.507 1.128 2.814 2.67 2.94 1.243.102 2.5.157 3.768.165l2.782 2.781a.75.75 0 0 0 1.28-.53v-2.39l.33-.026c1.542-.125 2.67-1.433 2.67-2.94v-4.286c0-1.505-1.125-2.811-2.664-2.94A49.392 49.392 0 0 0 15.75 7.5Z"}))}const A=s.forwardRef(L);function F({title:a,titleId:n,...o},d){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":n},o),a?s.createElement("title",{id:n},a):null,s.createElement("path",{fillRule:"evenodd",d:"M18.97 3.659a2.25 2.25 0 0 0-3.182 0l-10.94 10.94a3.75 3.75 0 1 0 5.304 5.303l7.693-7.693a.75.75 0 0 1 1.06 1.06l-7.693 7.693a5.25 5.25 0 1 1-7.424-7.424l10.939-10.94a3.75 3.75 0 1 1 5.303 5.304L9.097 18.835l-.008.008-.007.007-.002.002-.003.002A2.25 2.25 0 0 1 5.91 15.66l7.81-7.81a.75.75 0 0 1 1.061 1.06l-7.81 7.81a.75.75 0 0 0 1.054 1.068L18.97 6.84a2.25 2.25 0 0 0 0-3.182Z",clipRule:"evenodd"}))}const O=s.forwardRef(F);function $({title:a,titleId:n,...o},d){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":n},o),a?s.createElement("title",{id:n},a):null,s.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z",clipRule:"evenodd"}))}const I=s.forwardRef($),B=({avatar:a=null})=>t.jsxs(t.Fragment,{children:[a&&t.jsx("div",{className:"chat-image avatar",children:t.jsx("div",{className:"rounded-full w-8",children:t.jsx("img",{src:a})})}),!a&&t.jsx("div",{className:"avatar avatar-placeholder",children:t.jsx("div",{className:`
                bg-gray-400 text-gray-800 rounded-full w-8
                dark:bg-gray-700 dark:text-gray-100
            `,children:t.jsx("span",{className:"text-xl",children:t.jsx(R,{className:"w-4"})})})})]}),D=({conversation:a,selectedConversation:n=null,online:o=null})=>{const c=p().props.auth.user;let i=" border-transparent";return n&&n.id===a.id&&n.is_group===a.is_group&&(i="border-blue-500 bg-blue-50 dark:bg-gray-700/50 shadow-sm"),t.jsxs(h,{href:a.is_group?route("chat.group",a):route("chat.user",a),preserveState:!0,className:"conversation-item flex items-center justify-between gap-3 rounded-md p-3 transition-all cursor-pointer border  text-gray-800 hover:hover:bg-blue-50 dark:text-gray-200 dark:hover:bg-gray-700 "+i+(!a.is_group&&c.role==="admin"?" pr-2":" pr-4"),children:[!a.is_group&&t.jsx(S,{user:a,online:o}),a.is_group&&t.jsx(B,{avatar:a.avatar}),t.jsxs("div",{className:"flex-1 text-xs max-w-full overflow-hidden",children:[t.jsxs("div",{className:"flex gap-1 justify-between items-center",children:[t.jsx("h3",{className:"text-sm font-semibold truncate",children:a.name}),a.last_message_date&&t.jsx("span",{className:"text-nowrap text-gray-500 dark:text-gray-400",children:E(a.last_message_date)})]}),a.last_message_date&&(a.last_message?t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 text-nowrap truncate",children:a.last_message}):t.jsxs("p",{className:"text-xs text-gray-600 flex items-center justify-start gap-1 dark:text-gray-400 text-nowrap truncate",children:[t.jsx(O,{className:"w-3"})," Sent an attachment"]}))]})]})},Z=({children:a})=>{const n=p(),o=n.props.auth,d=n.props.conversations,c=n.props.selectedConversation,[i,u]=s.useState([]),[g,b]=s.useState([]),{on:m}=k(),[w,f]=s.useState({}),_=e=>w[e];s.useEffect(()=>{u(d)},[d]);const y=e=>{u(l=>l.map(r=>e.conversation_id&&!r.is_group&&r.id===parseInt(e.conversation_id)?("Notification"in window&&Notification.permission==="granted"&&e.sender_id!==o.user.id&&(new Notification("New Message",{body:e.message??"Sent an Attachment"}),new Audio("/notify.wav").play().catch(x=>{console.warn("Unable to play notification sound automatically:",x)})),{...r,last_message:e.message,last_message_date:e.created_at}):e.group_id&&r.is_group&&r.id===parseInt(e.group_id)?("Notification"in window&&Notification.permission==="granted"&&e.sender_id!==o.user.id&&(new Notification("New Message",{body:e.message??"Sent an Attachment"}),new Audio("/notify.wav").play().catch(x=>{console.warn("Unable to play notification sound automatically:",x)})),{...r,last_message:e.message,last_message_date:e.created_at}):r))},j=({prevMessage:e})=>{u(l=>l.map(r=>e.conversation_id&&!r.is_group&&r.id===parseInt(e.conversation_id)?{...r,last_message:e.message,last_message_date:e.created_at}:e.group_id&&r.is_group&&r.id===parseInt(e.group_id)?{...r,last_message:e.message,last_message_date:e.created_at}:r))};s.useEffect(()=>{const e=m("message.created",y),l=m("message.deleted",j);return()=>{e(),l()}},[m]),s.useEffect(()=>{b(i.filter(e=>e.last_message_date!==null).sort((e,l)=>e.last_message_date&&l.last_message_date?new Date(l.last_message_date)-new Date(e.last_message_date):e.last_message_date?-1:l.last_message_date?1:0))},[i]),s.useEffect(()=>(Echo.join("online").here(e=>{const l=Object.fromEntries(e.map(r=>[r.id,r]));f(r=>({...r,...l}))}).joining(e=>{f(l=>{const r={...l};return r[e.id]=e,r})}).leaving(e=>{f(l=>{const r={...l};return delete r[e.id],r})}).error(e=>{}),()=>{Echo.leave("online")}),[]);const v=e=>{const l=e.target.value.toLowerCase();u(d.filter(r=>r.name.toLowerCase().includes(l)))};return t.jsxs(t.Fragment,{children:[t.jsx(C,{title:"All Chats"}),t.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[t.jsxs("div",{className:`transition-all 
                                    w-full sm:w-[300px] 
                                    bg-gradient-to-b from-blue-50 to-white 
                                    dark:from-slate-800 dark:to-slate-900 
                                     flex-col overflow-hidden 
                                    border-r border-gray-200 dark:border-slate-700 shadow-sm
                                    ${c?"-ml-[100%] md:ml-0 lg:ml-0":"ml-0"}`,children:[t.jsxs("div",{className:`flex items-center justify-between py-3 px-4 text-lg font-semibold 
                                    text-gray-700 dark:text-gray-100 border-b border-gray-200 dark:border-slate-700`,children:["My Conversations",o.user.role==="admin"&&t.jsx("div",{className:"tooltip tooltip-left","data-tip":"Create New Group",children:t.jsx(h,{href:route("group.create"),className:"text-blue-500 hover:text-blue-700 dark:text-indigo-400 dark:hover:text-indigo-300",children:t.jsx(I,{className:"w-7 h-7 inline-block ml-2"})})})]}),t.jsx("div",{className:"p-3 border-b border-gray-200 dark:border-slate-700",children:t.jsx(U,{onKeyUp:v,placeholder:"Filter users and groups",className:`w-full bg-white/70 dark:bg-slate-700 
                                text-gray-800 dark:text-gray-100 
                                placeholder-gray-400 dark:placeholder-gray-300 
                                border border-gray-300 dark:border-slate-600 
                                focus:ring focus:ring-blue-400 focus:border-blue-400 rounded-lg `})}),t.jsxs("div",{className:"hide-scrollbar flex-1 overflow-y-auto px-2 pt-1 pb-5 space-y-1",children:[g&&g.map(e=>t.jsx(D,{conversation:e,selectedConversation:c,online:!!_(e.id)},`${e.is_group?"group_":"chat_"}${e.id}`)),g.length===0&&t.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-6",children:[t.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-4",children:t.jsx(A,{className:"h-12 w-12 text-gray-400"})}),t.jsx("h2",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:"No Conversations"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2 max-w-sm",children:"You are not in any group yet or havenâ€™t started a chat. Join a group or create a new one to begin chatting."})]})]})]}),t.jsx("div",{className:"w-full flex-1 mx-auto flex flex-col overflow-x-hidden overflow-y-auto bg-gray-50 dark:bg-slate-900 text-gray-800 dark:text-gray-100",children:a})]})]})},V=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{Z as C,O as F,B as G,A as a,V as b};
